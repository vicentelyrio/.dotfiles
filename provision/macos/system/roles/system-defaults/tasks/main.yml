---
# macOS System Defaults Configuration
- name: Dock - disable workspace reordering
  community.general.osx_defaults:
    domain: com.apple.dock
    key: mru-spaces
    type: bool
    value: false

- name: Dock - enable autohide
  community.general.osx_defaults:
    domain: com.apple.dock
    key: autohide
    type: bool
    value: true

- name: Dock - set small size
  community.general.osx_defaults:
    domain: com.apple.dock
    key: tilesize
    type: float
    value: 24.0

- name: Dock - disable magnification
  community.general.osx_defaults:
    domain: com.apple.dock
    key: magnification
    type: bool
    value: false

- name: Dock - remove all persistent apps
  community.general.osx_defaults:
    domain: com.apple.dock
    key: persistent-apps
    type: array
    value: []

- name: Dock - hide recents
  community.general.osx_defaults:
    domain: com.apple.dock
    key: show-recents
    type: bool
    value: false

- name: Keyboard - fastest repeat rate
  community.general.osx_defaults:
    domain: NSGlobalDomain
    key: KeyRepeat
    type: float
    value: 2.0

- name: Keyboard - minimal initial delay
  community.general.osx_defaults:
    domain: NSGlobalDomain
    key: InitialKeyRepeat
    type: float
    value: 15.0

- name: Show Bluetooth in menu bar (via defaults)
  community.general.osx_defaults:
    domain: com.apple.controlcenter
    key: Bluetooth
    type: int
    value: 18

- name: Configure automatic weekly updates
  ansible.builtin.command:
    cmd: sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate ScheduleFrequency -int 7
  ignore_errors: true
  register: ignore_errors_register

- name: Enable automatic security updates
  ansible.builtin.command:
    cmd: sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticCheckEnabled -bool true
  ignore_errors: true
  register: ignore_errors_register

- name: Enable firewall
  ansible.builtin.command:
    cmd: sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on
  ignore_errors: true
  register: ignore_errors_register

- name: Enable stealth mode
  ansible.builtin.command:
    cmd: sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setstealthmode on
  ignore_errors: true
  register: ignore_errors_register
