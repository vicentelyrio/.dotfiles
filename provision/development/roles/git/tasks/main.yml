# - name: Git - install git-cli
#   become: true
#   kewlfft.aur.aur:
#     use: yay
#     name:
#       - github-cli-git
#     state: present

- name: Git - create .gitconfig
  ansible.builtin.file:
    path: ~/.gitconfig
    mode: "0644"
    state: touch
  when: git is defined

# DEFAULT USER
- name: Git - create default user name
  community.general.git_config:
    name: user.name
    value: "{{ git.default.name }}"
    scope: global
    state: present
  when: git.default is defined

- name: Git - create default user email
  community.general.git_config:
    name: user.email
    value: "{{ git.default.email }}"
    scope: global
    state: present
  when: git.default is defined

# OPTIONS
- name: Git - create options
  community.general.git_config:
    name: "{{ item.key }}"
    value: "{{ item.value }}"
    scope: global
    state: present
  with_dict: "{{ git.options }}"
  when: git.options is defined

# OTHER USERS
- name: Git - create main file
  ansible.builtin.blockinfile:
    block: "{{ lookup('template', '../templates/gitconfig-main.j2') }}"
    dest: ~/.gitconfig
    mode: "0644"
    marker: "# {mark} custom github users"
    prepend_newline: true
  when: git.users is defined

- name: Git - create scope file
  ansible.builtin.template:
    src: ../templates/gitconfig.j2
    dest: "~/.gitconfig-{{ item.scope }}"
    mode: "0644"
  with_items: "{{ git.users }}"
  when: git.users is defined
